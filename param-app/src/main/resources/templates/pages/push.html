<!DOCTYPE html>
<html layout:decorate="~{layouts/pages.html}">
<head>
</head>
<body>
    <span layout:fragment="content">
		<h5>Export de lots de modifications pour le projet <span th:class="|project-theme-txt-${project.color}|" th:text="${project.name}">project</span></h5>
		<span class="help">L'export complet se fait à partir du 1er lot selectionné. Les exports de lots ne comportent que les données du projet courant.</span>
		<table class="table table-sm">
			<thead>
				<tr>
		            <th scope="col">Lots de modifications</th>
		            <th scope="col">Domains couverts</th>
		            <th scope="col">Créé par</th>
		            <th scope="col">Le</th>
		            <th scope="col" width="15%"><a href="#" id="exportAll" th:href="@{/ui/push/all-commits.par}" class="btn btn-success btn-sm float-right">Exporter tous les lots</a></th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="commit, cstat : ${commits}" th:id="${commit.uuid}">
					<td th:text="${commit.comment}">Préchargement configuration</td>
		            <td th:text="${commit.domainNames}">Fonct domains</td>
		            <td th:text="${commit.originalUserEmail}">System</td>
		            <td th:text="${custom.format(commit.createdTime)}">01/11/2017</td>
					<td>
						<div class="float-right">
							<div th:id="|selecterFor${commit.uuid}|" class="selecter selected" title="Activer l'export complet à partir de ce lot">&nbsp;</div>&nbsp;&nbsp;
							<a href="#" th:href="@{/ui/push/{id}-commit.par(id=${commit.uuid})}" class="btn btn-primary btn-sm">Exporter seul</a>
						</div>
					</td>
				</tr>
			</tbody>
		</table>
		<input type="hidden" id="endSelect" value=""/>
	</span>
	<script layout:fragment="script">
		 /*<![CDATA[*/
		
        // When selecting
        const selectAction = (item) => {
			hideDisplays();
        	var selectValue = $("#endSelect");
			if(selectValue.val() !== item){
        		var selectId = 'selecterFor' + item;
        		var selects = $("div.selecter");
       			var i = selects.length;
       			selects.each((idx,e) => {
					console.log(idx + "|" + i + "-" + e.id + " " + e.className);
       				e.className = "selecter unselected" ;

       				if(e.id === selectId){
       					selectValue.val(item);
       					i = idx;
       				}
       				
       				if(idx >= i){
       					e.className = "selecter selected" ;
       				}
       			});
       			var exportAllB = $("#exportAll");
       			if(i === 0){
       				exportAllB.text("Exporter tous les lots");
					exportAllB.removeClass("btn-primary").addClass("btn-success");
					exportAllB.prop('href','/ui/push/all-commits.par');
       			}else{
       				exportAllB.text("Exporter à partir du lot");
					exportAllB.removeClass("btn-success").addClass("btn-primary");
					exportAllB.prop('href','/ui/push/until-' + item + '-commits.par');
       			}
			}
        };
        
        // Init actions
    	$(document).ready(() => {
			$("div.selecter").click((e) => selectAction(e.target.parentElement.parentElement.parentElement.id));
		}); 
        
        /*]]>*/
	</script>
</body>
</html>